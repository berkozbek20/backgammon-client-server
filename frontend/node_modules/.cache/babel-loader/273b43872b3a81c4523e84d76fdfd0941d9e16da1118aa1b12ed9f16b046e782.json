{"ast":null,"code":"// backend-ws.js\n// ==========================================\n// REAL BACKEND ADAPTER (WebSocket)\n// ==========================================\n\nexport const Player = {\n  WHITE: \"WHITE\",\n  BLACK: \"BLACK\"\n};\nexport class TavlaGame {\n  constructor({\n    url\n  } = {}) {\n    this.url = resolveWsUrl(url);\n    this.onChat = null;\n    this.ws = null;\n\n    // Backend’den gelen son state\n    this.lastState = null;\n\n    // UI tarafında \"event\" gibi kullanmak için\n    this.onState = null; // (state) => void\n    this.onError = null; // (message) => void\n    this.onInfo = null; // (message) => void\n\n    // Oda bilgisi\n    this.roomId = null;\n    this.player = null; // \"WHITE\" / \"BLACK\"\n  }\n  sendChatMessage(text) {\n    const message = (text !== null && text !== void 0 ? text : \"\").trim();\n    if (!message) return;\n\n    // roomId yoksa da istersen gönderme:\n    if (!this.roomId) {\n      if (this.onError) this.onError(\"Chat için önce odaya gir.\");\n      return;\n    }\n    this._send({\n      type: \"chat_message\",\n      payload: {\n        roomId: this.roomId,\n        message\n      }\n    });\n  }\n\n  // ---------- Connection ----------\n  connect() {\n    if (this.ws && (this.ws.readyState === WebSocket.OPEN || this.ws.readyState === WebSocket.CONNECTING)) {\n      return;\n    }\n    this.ws = new WebSocket(this.url);\n    this.ws.onopen = () => {\n      // bağlandı\n    };\n    this.ws.onmessage = e => {\n      try {\n        const msg = JSON.parse(e.data);\n        if (msg.type === \"state\") {\n          // Server state payload formatı: { gameOver, currentPlayer, winner, dice, board }\n          // Biz bunu mock'taki snapshot'a benzeteceğiz.\n          this.lastState = this._mapServerStateToSnapshot(msg.payload);\n          if (this.onState) this.onState(this.lastState);\n          return;\n        }\n        if (msg.type === \"chat_message\") {\n          var _msg$payload, _msg$payload2, _msg$payload3, _msg$payload4;\n          if (this.onChat) this.onChat({\n            roomId: (_msg$payload = msg.payload) === null || _msg$payload === void 0 ? void 0 : _msg$payload.roomId,\n            sender: (_msg$payload2 = msg.payload) === null || _msg$payload2 === void 0 ? void 0 : _msg$payload2.sender,\n            message: (_msg$payload3 = msg.payload) === null || _msg$payload3 === void 0 ? void 0 : _msg$payload3.message,\n            ts: (_msg$payload4 = msg.payload) === null || _msg$payload4 === void 0 ? void 0 : _msg$payload4.ts\n          });\n          return;\n        }\n        if (msg.type === \"room_created\" || msg.type === \"room_joined\") {\n          this.roomId = msg.payload.roomId;\n          this.player = msg.payload.player; // \"WHITE\"/\"BLACK\"\n          // UI isterse bu bilgiyi kullanabilir\n          return;\n        }\n        if (msg.type === \"error\") {\n          var _msg$payload$message, _msg$payload5;\n          if (this.onError) this.onError((_msg$payload$message = (_msg$payload5 = msg.payload) === null || _msg$payload5 === void 0 ? void 0 : _msg$payload5.message) !== null && _msg$payload$message !== void 0 ? _msg$payload$message : \"Unknown error\");\n          return;\n        }\n        if (msg.type === \"info\") {\n          var _msg$payload$message2, _msg$payload6;\n          if (this.onInfo) this.onInfo((_msg$payload$message2 = (_msg$payload6 = msg.payload) === null || _msg$payload6 === void 0 ? void 0 : _msg$payload6.message) !== null && _msg$payload$message2 !== void 0 ? _msg$payload$message2 : \"\");\n          return;\n        }\n      } catch (err) {\n        if (this.onError) this.onError(\"Mesaj parse edilemedi: \" + err.message);\n      }\n    };\n    this.ws.onerror = () => {\n      if (this.onError) this.onError(\"WebSocket bağlantı hatası.\");\n    };\n    this.ws.onclose = () => {\n      // bağlantı kapandı\n    };\n  }\n\n  // ---------- Room ----------\n  createRoom() {\n    this._send({\n      type: \"create_room\"\n    });\n  }\n  joinRoom(roomId) {\n    this._send({\n      type: \"join_room\",\n      payload: {\n        roomId\n      }\n    });\n  }\n\n  // ---------- Game actions (mock ile aynı isimler) ----------\n  rollDice() {\n    this._send({\n      type: \"roll\"\n    });\n  }\n  applyMove(fromIndex, toIndex, step) {\n    // Backend bizde yön ve legality kontrolünü yapıyor.\n    // Burada sadece gönderiyoruz.\n    this._send({\n      type: \"move\",\n      payload: {\n        from: fromIndex,\n        to: toIndex,\n        step\n      }\n    });\n    // mock boolean dönüyordu; gerçek backend async.\n    // İstersen true döndürüp UI’yı bloklamayabilirsin:\n    return true;\n  }\n\n  // ---------- UI'nin beklediği snapshot ----------\n  getBoardSnapshot() {\n    // mock: {points, whiteBar, blackBar, whiteOff, blackOff, dice, winner}\n    return this.lastState;\n  }\n  getCurrentPlayer() {\n    var _this$lastState$curre, _this$lastState;\n    return (_this$lastState$curre = (_this$lastState = this.lastState) === null || _this$lastState === void 0 ? void 0 : _this$lastState.currentPlayer) !== null && _this$lastState$curre !== void 0 ? _this$lastState$curre : Player.WHITE;\n  }\n  getRemainingSteps() {\n    var _this$lastState$dice, _this$lastState2;\n    return (_this$lastState$dice = (_this$lastState2 = this.lastState) === null || _this$lastState2 === void 0 ? void 0 : _this$lastState2.dice) !== null && _this$lastState$dice !== void 0 ? _this$lastState$dice : [];\n  }\n  checkWinner() {\n    var _this$lastState$winne, _this$lastState3;\n    return (_this$lastState$winne = (_this$lastState3 = this.lastState) === null || _this$lastState3 === void 0 ? void 0 : _this$lastState3.winner) !== null && _this$lastState$winne !== void 0 ? _this$lastState$winne : null;\n  }\n\n  // ---------- Legal move highlight (şimdilik client-side hesap) ----------\n  // Senin server’da \"getLegalMoves\" mesajı yok, o yüzden UI highlight için\n  // mock’taki mantığı, gelen state üzerinden burada hesaplıyoruz.\n  getLegalMoves(fromIndex) {\n    if (!this.lastState) return [];\n    return computeLegalMovesFromSnapshot(this.lastState, fromIndex);\n  }\n  getAllLegalMoves() {\n    if (!this.lastState) return [];\n    return computeAllLegalMovesFromSnapshot(this.lastState);\n  }\n\n  // ---------- Internals ----------\n  _send(obj) {\n    if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\n      // bağlantı yoksa otomatik bağlanmayı deneyelim\n      this.connect();\n      // connect olur olmaz göndermek race yaratabilir; basit çözüm:\n      setTimeout(() => {\n        if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n          this.ws.send(JSON.stringify(obj));\n        } else {\n          if (this.onError) this.onError(\"WebSocket henüz açık değil.\");\n        }\n      }, 100);\n      return;\n    }\n    this.ws.send(JSON.stringify(obj));\n  }\n  _mapServerStateToSnapshot(payload) {\n    var _payload$dice$remaini;\n    // Server payload:\n    // { gameOver, currentPlayer, winner, dice:{die1,die2,remainingSteps}, board:{whiteBar,blackBar,whiteBornOff,blackBornOff,points:[{index,owner,count}]}}\n    const points = payload.board.points.map(p => ({\n      index: p.index,\n      owner: p.owner,\n      // \"WHITE\"/\"BLACK\"/null\n      count: p.count\n    }));\n    return {\n      points,\n      whiteBar: payload.board.whiteBar,\n      blackBar: payload.board.blackBar,\n      whiteOff: payload.board.whiteBornOff,\n      blackOff: payload.board.blackBornOff,\n      dice: (_payload$dice$remaini = payload.dice.remainingSteps) !== null && _payload$dice$remaini !== void 0 ? _payload$dice$remaini : [],\n      winner: payload.winner,\n      currentPlayer: payload.currentPlayer\n    };\n  }\n}\n\n// --------------------\n// CLIENT-SIDE LEGAL MOVES (UI highlight için)\n// Bu hesap backend ile birebir olmak zorunda; biz senin backend kuralına göre yazıyoruz:\n// WHITE: index azaltır, BLACK: index artırır\n// Bar/bearing off'u şimdilik minimum tutuyoruz. (İstersen sonra server’dan \"legalMoves\" isteği ekleriz.)\n// --------------------\n\nfunction canBearOff(snapshot, player) {\n  if (player === Player.WHITE) {\n    if (snapshot.whiteBar > 0) return false;\n    for (let i = 6; i < 24; i++) {\n      if (snapshot.points[i].owner === Player.WHITE) return false;\n    }\n    return true;\n  } else {\n    if (snapshot.blackBar > 0) return false;\n    for (let i = 0; i < 18; i++) {\n      if (snapshot.points[i].owner === Player.BLACK) return false;\n    }\n    return true;\n  }\n}\nfunction resolveWsUrl(explicitUrl) {\n  if (explicitUrl) return explicitUrl;\n\n  // CRA env: process yoksa patlamasın\n  const envUrl = typeof process !== \"undefined\" && process.env && process.env.REACT_APP_WS_URL ? process.env.REACT_APP_WS_URL : null;\n  if (envUrl) return envUrl;\n\n  // Prod same-origin (nginx /ws)\n  if (typeof window !== \"undefined\" && window.location) {\n    const isHttps = window.location.protocol === \"https:\";\n    const proto = isHttps ? \"wss\" : \"ws\";\n    return `${proto}://${window.location.host}/ws`;\n  }\n\n  // Dev fallback\n  return \"ws://localhost:8080\";\n}\nfunction computeLegalMovesFromSnapshot(snapshot, fromIndex) {\n  var _snapshot$dice;\n  const moves = [];\n  const dice = (_snapshot$dice = snapshot.dice) !== null && _snapshot$dice !== void 0 ? _snapshot$dice : [];\n  const uniqueDice = [...new Set(dice)];\n  const current = snapshot.currentPlayer;\n  const direction = current === Player.WHITE ? -1 : 1;\n  const canOff = canBearOff(snapshot, current);\n  const fromPoint = snapshot.points[fromIndex];\n  if (!fromPoint || fromPoint.owner !== current || fromPoint.count <= 0) return moves;\n  for (const die of uniqueDice) {\n    const targetIdx = fromIndex + die * direction;\n    if (targetIdx >= 0 && targetIdx <= 23) {\n      const target = snapshot.points[targetIdx];\n      if (!target.owner || target.owner === current || target.count === 1) {\n        moves.push(targetIdx);\n      }\n    } else if (canOff) {\n      // Server tarafında bearing off’u nasıl temsil ettiğine göre ayarlamak gerekir.\n      // Şimdilik UI için 'off' gösterebiliriz.\n      if (current === Player.WHITE && targetIdx === -1 || current === Player.BLACK && targetIdx === 24) {\n        moves.push(\"off\");\n      }\n    }\n  }\n  return moves;\n}\nfunction computeAllLegalMovesFromSnapshot(snapshot) {\n  var _snapshot$dice2;\n  const allMoves = [];\n  const dice = (_snapshot$dice2 = snapshot.dice) !== null && _snapshot$dice2 !== void 0 ? _snapshot$dice2 : [];\n  const uniqueDice = [...new Set(dice)];\n  const current = snapshot.currentPlayer;\n  const direction = current === Player.WHITE ? -1 : 1;\n  const canOff = canBearOff(snapshot, current);\n\n  // Bar önceliği: UI’da istersen ekleyebilirsin.\n  const hasBar = current === Player.WHITE && snapshot.whiteBar > 0 || current === Player.BLACK && snapshot.blackBar > 0;\n  if (hasBar) {\n    for (const die of uniqueDice) {\n      const targetIdx = current === Player.WHITE ? 24 - die : die - 1;\n      if (targetIdx >= 0 && targetIdx <= 23) {\n        const target = snapshot.points[targetIdx];\n        if (!target.owner || target.owner === current || target.count === 1) {\n          allMoves.push({\n            from: \"bar\",\n            to: targetIdx,\n            die\n          });\n        }\n      }\n    }\n    return allMoves;\n  }\n  for (const p of snapshot.points) {\n    if (p.owner === current && p.count > 0) {\n      for (const die of uniqueDice) {\n        const targetIdx = p.index + die * direction;\n        if (targetIdx >= 0 && targetIdx <= 23) {\n          const target = snapshot.points[targetIdx];\n          if (!target.owner || target.owner === current || target.count === 1) {\n            allMoves.push({\n              from: p.index,\n              to: targetIdx,\n              die\n            });\n          }\n        } else if (canOff) {\n          if (current === Player.WHITE && targetIdx === -1 || current === Player.BLACK && targetIdx === 24) {\n            allMoves.push({\n              from: p.index,\n              to: \"off\",\n              die\n            });\n          }\n        }\n      }\n    }\n  }\n  return allMoves;\n}","map":{"version":3,"names":["Player","WHITE","BLACK","TavlaGame","constructor","url","resolveWsUrl","onChat","ws","lastState","onState","onError","onInfo","roomId","player","sendChatMessage","text","message","trim","_send","type","payload","connect","readyState","WebSocket","OPEN","CONNECTING","onopen","onmessage","e","msg","JSON","parse","data","_mapServerStateToSnapshot","_msg$payload","_msg$payload2","_msg$payload3","_msg$payload4","sender","ts","_msg$payload$message","_msg$payload5","_msg$payload$message2","_msg$payload6","err","onerror","onclose","createRoom","joinRoom","rollDice","applyMove","fromIndex","toIndex","step","from","to","getBoardSnapshot","getCurrentPlayer","_this$lastState$curre","_this$lastState","currentPlayer","getRemainingSteps","_this$lastState$dice","_this$lastState2","dice","checkWinner","_this$lastState$winne","_this$lastState3","winner","getLegalMoves","computeLegalMovesFromSnapshot","getAllLegalMoves","computeAllLegalMovesFromSnapshot","obj","setTimeout","send","stringify","_payload$dice$remaini","points","board","map","p","index","owner","count","whiteBar","blackBar","whiteOff","whiteBornOff","blackOff","blackBornOff","remainingSteps","canBearOff","snapshot","i","explicitUrl","envUrl","process","env","REACT_APP_WS_URL","window","location","isHttps","protocol","proto","host","_snapshot$dice","moves","uniqueDice","Set","current","direction","canOff","fromPoint","die","targetIdx","target","push","_snapshot$dice2","allMoves","hasBar"],"sources":["C:/Users/11/Desktop/Yeni klasör/backgammon-client-server/src/backend-ws.js"],"sourcesContent":["// backend-ws.js\r\n// ==========================================\r\n// REAL BACKEND ADAPTER (WebSocket)\r\n// ==========================================\r\n\r\nexport const Player = { WHITE: \"WHITE\", BLACK: \"BLACK\" };\r\n\r\nexport class TavlaGame {\r\n    constructor({ url } = {}) {\r\n        this.url = resolveWsUrl(url);\r\n        this.onChat = null;\r\n        this.ws = null;\r\n\r\n        // Backend’den gelen son state\r\n        this.lastState = null;\r\n\r\n        // UI tarafında \"event\" gibi kullanmak için\r\n        this.onState = null;   // (state) => void\r\n        this.onError = null;   // (message) => void\r\n        this.onInfo = null;    // (message) => void\r\n\r\n        // Oda bilgisi\r\n        this.roomId = null;\r\n        this.player = null; // \"WHITE\" / \"BLACK\"\r\n    }\r\n\r\n    sendChatMessage(text) {\r\n        const message = (text ?? \"\").trim();\r\n        if (!message) return;\r\n\r\n        // roomId yoksa da istersen gönderme:\r\n        if (!this.roomId) {\r\n            if (this.onError) this.onError(\"Chat için önce odaya gir.\");\r\n            return;\r\n        }\r\n\r\n        this._send({\r\n            type: \"chat_message\",\r\n            payload: { roomId: this.roomId, message }\r\n        });\r\n    }\r\n\r\n\r\n    // ---------- Connection ----------\r\n    connect() {\r\n        if (this.ws && (this.ws.readyState === WebSocket.OPEN || this.ws.readyState === WebSocket.CONNECTING)) {\r\n            return;\r\n        }\r\n        \r\n\r\n        this.ws = new WebSocket(this.url);\r\n\r\n        this.ws.onopen = () => {\r\n            // bağlandı\r\n        };\r\n\r\n        this.ws.onmessage = (e) => {\r\n            try {\r\n                const msg = JSON.parse(e.data);\r\n\r\n                if (msg.type === \"state\") {\r\n                    // Server state payload formatı: { gameOver, currentPlayer, winner, dice, board }\r\n                    // Biz bunu mock'taki snapshot'a benzeteceğiz.\r\n                    this.lastState = this._mapServerStateToSnapshot(msg.payload);\r\n\r\n                    if (this.onState) this.onState(this.lastState);\r\n                    return;\r\n                }\r\n\r\n                if (msg.type === \"chat_message\") {\r\n                    if (this.onChat) this.onChat({\r\n                        roomId: msg.payload?.roomId,\r\n                        sender: msg.payload?.sender,\r\n                        message: msg.payload?.message,\r\n                        ts: msg.payload?.ts\r\n                    });\r\n                    return;\r\n                }\r\n\r\n\r\n                if (msg.type === \"room_created\" || msg.type === \"room_joined\") {\r\n                    this.roomId = msg.payload.roomId;\r\n                    this.player = msg.payload.player; // \"WHITE\"/\"BLACK\"\r\n                    // UI isterse bu bilgiyi kullanabilir\r\n                    return;\r\n                }\r\n\r\n                if (msg.type === \"error\") {\r\n                    if (this.onError) this.onError(msg.payload?.message ?? \"Unknown error\");\r\n                    return;\r\n                }\r\n\r\n                if (msg.type === \"info\") {\r\n                    if (this.onInfo) this.onInfo(msg.payload?.message ?? \"\");\r\n                    return;\r\n                }\r\n\r\n            } catch (err) {\r\n                if (this.onError) this.onError(\"Mesaj parse edilemedi: \" + err.message);\r\n            }\r\n        };\r\n\r\n        this.ws.onerror = () => {\r\n            if (this.onError) this.onError(\"WebSocket bağlantı hatası.\");\r\n        };\r\n\r\n        this.ws.onclose = () => {\r\n            // bağlantı kapandı\r\n        };\r\n\r\n\r\n    }\r\n\r\n    // ---------- Room ----------\r\n    createRoom() {\r\n        this._send({ type: \"create_room\" });\r\n    }\r\n\r\n    joinRoom(roomId) {\r\n        this._send({ type: \"join_room\", payload: { roomId } });\r\n    }\r\n\r\n    // ---------- Game actions (mock ile aynı isimler) ----------\r\n    rollDice() {\r\n        this._send({ type: \"roll\" });\r\n    }\r\n\r\n    applyMove(fromIndex, toIndex, step) {\r\n        // Backend bizde yön ve legality kontrolünü yapıyor.\r\n        // Burada sadece gönderiyoruz.\r\n        this._send({\r\n            type: \"move\",\r\n            payload: { from: fromIndex, to: toIndex, step }\r\n        });\r\n        // mock boolean dönüyordu; gerçek backend async.\r\n        // İstersen true döndürüp UI’yı bloklamayabilirsin:\r\n        return true;\r\n    }\r\n\r\n    // ---------- UI'nin beklediği snapshot ----------\r\n    getBoardSnapshot() {\r\n        // mock: {points, whiteBar, blackBar, whiteOff, blackOff, dice, winner}\r\n        return this.lastState;\r\n    }\r\n\r\n    getCurrentPlayer() {\r\n        return this.lastState?.currentPlayer ?? Player.WHITE;\r\n    }\r\n\r\n    getRemainingSteps() {\r\n        return this.lastState?.dice ?? [];\r\n    }\r\n\r\n    checkWinner() {\r\n        return this.lastState?.winner ?? null;\r\n    }\r\n\r\n    // ---------- Legal move highlight (şimdilik client-side hesap) ----------\r\n    // Senin server’da \"getLegalMoves\" mesajı yok, o yüzden UI highlight için\r\n    // mock’taki mantığı, gelen state üzerinden burada hesaplıyoruz.\r\n    getLegalMoves(fromIndex) {\r\n        if (!this.lastState) return [];\r\n        return computeLegalMovesFromSnapshot(this.lastState, fromIndex);\r\n    }\r\n\r\n    getAllLegalMoves() {\r\n        if (!this.lastState) return [];\r\n        return computeAllLegalMovesFromSnapshot(this.lastState);\r\n    }\r\n\r\n    // ---------- Internals ----------\r\n    _send(obj) {\r\n        if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\r\n            // bağlantı yoksa otomatik bağlanmayı deneyelim\r\n            this.connect();\r\n            // connect olur olmaz göndermek race yaratabilir; basit çözüm:\r\n            setTimeout(() => {\r\n                if (this.ws && this.ws.readyState === WebSocket.OPEN) {\r\n                    this.ws.send(JSON.stringify(obj));\r\n                } else {\r\n                    if (this.onError) this.onError(\"WebSocket henüz açık değil.\");\r\n                }\r\n            }, 100);\r\n            return;\r\n        }\r\n        this.ws.send(JSON.stringify(obj));\r\n    }\r\n\r\n\r\n\r\n    _mapServerStateToSnapshot(payload) {\r\n        // Server payload:\r\n        // { gameOver, currentPlayer, winner, dice:{die1,die2,remainingSteps}, board:{whiteBar,blackBar,whiteBornOff,blackBornOff,points:[{index,owner,count}]}}\r\n        const points = payload.board.points.map(p => ({\r\n            index: p.index,\r\n            owner: p.owner, // \"WHITE\"/\"BLACK\"/null\r\n            count: p.count\r\n        }));\r\n\r\n        return {\r\n            points,\r\n            whiteBar: payload.board.whiteBar,\r\n            blackBar: payload.board.blackBar,\r\n            whiteOff: payload.board.whiteBornOff,\r\n            blackOff: payload.board.blackBornOff,\r\n            dice: payload.dice.remainingSteps ?? [],\r\n            winner: payload.winner,\r\n            currentPlayer: payload.currentPlayer\r\n        };\r\n    }\r\n}\r\n\r\n// --------------------\r\n// CLIENT-SIDE LEGAL MOVES (UI highlight için)\r\n// Bu hesap backend ile birebir olmak zorunda; biz senin backend kuralına göre yazıyoruz:\r\n// WHITE: index azaltır, BLACK: index artırır\r\n// Bar/bearing off'u şimdilik minimum tutuyoruz. (İstersen sonra server’dan \"legalMoves\" isteği ekleriz.)\r\n// --------------------\r\n\r\nfunction canBearOff(snapshot, player) {\r\n    if (player === Player.WHITE) {\r\n        if (snapshot.whiteBar > 0) return false;\r\n        for (let i = 6; i < 24; i++) {\r\n            if (snapshot.points[i].owner === Player.WHITE) return false;\r\n        }\r\n        return true;\r\n    } else {\r\n        if (snapshot.blackBar > 0) return false;\r\n        for (let i = 0; i < 18; i++) {\r\n            if (snapshot.points[i].owner === Player.BLACK) return false;\r\n        }\r\n        return true;\r\n    }\r\n}\r\nfunction resolveWsUrl(explicitUrl) {\r\n    if (explicitUrl) return explicitUrl;\r\n\r\n    // CRA env: process yoksa patlamasın\r\n    const envUrl =\r\n        typeof process !== \"undefined\" &&\r\n        process.env &&\r\n        process.env.REACT_APP_WS_URL\r\n            ? process.env.REACT_APP_WS_URL\r\n            : null;\r\n\r\n    if (envUrl) return envUrl;\r\n\r\n    // Prod same-origin (nginx /ws)\r\n    if (typeof window !== \"undefined\" && window.location) {\r\n        const isHttps = window.location.protocol === \"https:\";\r\n        const proto = isHttps ? \"wss\" : \"ws\";\r\n        return `${proto}://${window.location.host}/ws`;\r\n    }\r\n\r\n    // Dev fallback\r\n    return \"ws://localhost:8080\";\r\n}\r\n\r\n\r\n\r\n\r\nfunction computeLegalMovesFromSnapshot(snapshot, fromIndex) {\r\n    const moves = [];\r\n    const dice = snapshot.dice ?? [];\r\n    const uniqueDice = [...new Set(dice)];\r\n\r\n    const current = snapshot.currentPlayer;\r\n    const direction = current === Player.WHITE ? -1 : 1;\r\n    const canOff = canBearOff(snapshot, current);\r\n\r\n    const fromPoint = snapshot.points[fromIndex];\r\n    if (!fromPoint || fromPoint.owner !== current || fromPoint.count <= 0) return moves;\r\n\r\n    for (const die of uniqueDice) {\r\n        const targetIdx = fromIndex + (die * direction);\r\n\r\n        if (targetIdx >= 0 && targetIdx <= 23) {\r\n            const target = snapshot.points[targetIdx];\r\n            if (!target.owner || target.owner === current || target.count === 1) {\r\n                moves.push(targetIdx);\r\n            }\r\n        } else if (canOff) {\r\n            // Server tarafında bearing off’u nasıl temsil ettiğine göre ayarlamak gerekir.\r\n            // Şimdilik UI için 'off' gösterebiliriz.\r\n            if ((current === Player.WHITE && targetIdx === -1) || (current === Player.BLACK && targetIdx === 24)) {\r\n                moves.push(\"off\");\r\n            }\r\n        }\r\n    }\r\n\r\n    return moves;\r\n}\r\n\r\nfunction computeAllLegalMovesFromSnapshot(snapshot) {\r\n    const allMoves = [];\r\n    const dice = snapshot.dice ?? [];\r\n    const uniqueDice = [...new Set(dice)];\r\n\r\n    const current = snapshot.currentPlayer;\r\n    const direction = current === Player.WHITE ? -1 : 1;\r\n    const canOff = canBearOff(snapshot, current);\r\n\r\n    // Bar önceliği: UI’da istersen ekleyebilirsin.\r\n    const hasBar = (current === Player.WHITE && snapshot.whiteBar > 0) ||\r\n        (current === Player.BLACK && snapshot.blackBar > 0);\r\n\r\n    if (hasBar) {\r\n        for (const die of uniqueDice) {\r\n            const targetIdx = current === Player.WHITE ? 24 - die : die - 1;\r\n            if (targetIdx >= 0 && targetIdx <= 23) {\r\n                const target = snapshot.points[targetIdx];\r\n                if (!target.owner || target.owner === current || target.count === 1) {\r\n                    allMoves.push({ from: \"bar\", to: targetIdx, die });\r\n                }\r\n            }\r\n        }\r\n        return allMoves;\r\n    }\r\n\r\n    for (const p of snapshot.points) {\r\n        if (p.owner === current && p.count > 0) {\r\n            for (const die of uniqueDice) {\r\n                const targetIdx = p.index + (die * direction);\r\n\r\n                if (targetIdx >= 0 && targetIdx <= 23) {\r\n                    const target = snapshot.points[targetIdx];\r\n                    if (!target.owner || target.owner === current || target.count === 1) {\r\n                        allMoves.push({ from: p.index, to: targetIdx, die });\r\n                    }\r\n                } else if (canOff) {\r\n                    if ((current === Player.WHITE && targetIdx === -1) ||\r\n                        (current === Player.BLACK && targetIdx === 24)) {\r\n                        allMoves.push({ from: p.index, to: \"off\", die });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return allMoves;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}